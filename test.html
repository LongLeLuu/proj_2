<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Metrics Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <h1>Team Metrics Dashboard</h1>
    </header>
    
    <div class="container">
        <aside class="sidebar">
            <nav>
                <ul>
                    <li><a href="#">Overview</a></li>
                    <li><a href="#">Commits</a></li>
                    <li><a href="#">Code Quality</a></li>
                    <li><a href="#">Reviews</a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <section class="search-section">
                <form id="commandForm">
                    <label for="reason">Enter Reason or Subject</label>
                    <input type="text" id="search-input" placeholder="Reason/Subject..." oninput="filterKPIs()" autocomplete="off">
                    <button type="submit">Search</button>
                </form>
                <div id="autocomplete-list" class="autocomplete-items"></div>
            </section>

            <section class="kpi-section" id="kpi-section">
                <div class="kpi-card" data-email="team1@example.com">
                    <h3>Team: Alpha</h3>
                    <p>Total Commits: <span>123</span></p>
                </div>
                <div class="kpi-card" data-email="team2@example.com">
                    <h3>Team: Beta</h3>
                    <p>Open Reviews: <span>8</span></p>
                </div>
                <div class="kpi-card" data-email="team3@example.com">
                    <h3>Team: Gamma</h3>
                    <p>Bugs Fixed: <span>15</span></p>
                </div>
            </section>

            <section class="charts-section">
                <div class="chart-card">
                    <h3>Commit Trends</h3>
                    [Chart Placeholder]
                </div>
                <div class="chart-card">
                    <h3>Code Quality Metrics</h3>
                    [Chart Placeholder]
                </div>
            </section>

            <section class="table-section">
                <div class="table-card">
                    <h3>Review Summary</h3>
                    [Table Placeholder]
                </div>
            </section>
        </main>
    </div>
    <footer class="footer">
        <p>&copy; 2024 Team Metrics Dashboard</p>
    </footer>
    <script src="script.js">
        document.addEventListener('DOMContentLoaded', () => {
        // Example: Update KPIs dynamically
        });

        const teams = [
            { email: 'team1@example.com', name: 'Alpha', totalCommits: 123 },
            { email: 'team2@example.com', name: 'Beta', openReviews: 8 },
            { email: 'team3@example.com', name: 'Gamma', bugsFixed: 15 }
        ];

        function filterKPIs() {
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            const kpiCards = document.querySelectorAll('.kpi-card');
            const autocompleteList = document.getElementById('autocomplete-list');
            autocompleteList.innerHTML = '';

            if (!searchInput) {
                // If input is empty, show all KPI cards and hide autocomplete suggestions
                kpiCards.forEach(card => card.style.display = 'flex');
                return;
            }

            // Filter KPI cards based on search input
            kpiCards.forEach(card => {
                const email = card.getAttribute('data-email').toLowerCase();
                if (email.includes(searchInput)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });

            // Generate autocomplete suggestions based on input
            const matchingTeams = teams.filter(team => team.email.toLowerCase().includes(searchInput));
            matchingTeams.forEach(team => {
                const item = document.createElement('div');
                item.classList.add('autocomplete-item');
                item.textContent = team.email;
                item.onclick = () => selectAutocompleteItem(team.email);
                autocompleteList.appendChild(item);
            });
        }

        function selectAutocompleteItem(email) {
            // Set the search input to the selected email and filter KPIs
            document.getElementById('search-input').value = email;
            filterKPIs();
            // Clear autocomplete suggestions after selection
            document.getElementById('autocomplete-list').innerHTML = '';
        }

        document.getElementById('commandForm').addEventListener('submit', async function (e) {
            e.preventDefault(); // Prevent the default form submission

            const reason = document.getElementById('reason').value;

            // Send the reason to the server via POST
            const response = await fetch('/run-command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ reason: reason })
            });

            const result = await response.text();
            document.getElementById('output').innerText = result;
        });
    </script>
</body>
</html>
